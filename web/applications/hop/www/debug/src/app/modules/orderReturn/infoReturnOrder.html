 <script type="text/ng-template" id="set_remark.html">
  <div class="modal-header">
      <h3 class="modal-title">{{items.headerText}}</h3>
  </div>
  <div class="modal-body">
      <h2 class="text-center">{{items.bodyText}}</h2>
      <div class="form-group" >
      请填写备注信息
      <textarea cols="20" rows="6" class="form-control" ng-model="items.remark_msg"></textarea>
      </div>
  </div>
  <div class="modal-footer">
      <button class="btn btn-primary" ng-click="items.ok(items.remark_msg,1);cancel();" ng-if="items.actionText">
        {{items.actionText}}
      </button>
      <button class="btn btn-warning" ng-click="items.ok('',0);cancel()">{{    items.closeText}}</button>
  </div>
</script>
<script type="text/ng-template" id="close_order.html">
  <div class="modal-header">
      <h3 class="modal-title">{{items.headerText}}</h3>
  </div>
  <div class="modal-body">
      <h2 class="text-center">{{items.bodyText}}</h2>
      <div class="form-group" >
      确定关闭此退货退款单吗？
      <input class="form-control" ng-model="items.remark_msg" placeholder="请输入关闭理由"/>
      </div>
  </div>
  <div class="modal-footer">
      <button class="btn btn-primary" ng-click="items.ok(items.remark_msg,1);cancel();" ng-if="items.actionText">
        {{items.actionText}}
      </button>
      <button class="btn btn-warning" ng-click="items.ok('',0);cancel()">{{ items.closeText}}</button>
  </div>
</script>
<div class="container-fluid">
  <div class="width_change" id="row block-title">
    <div class="col-sm-offset-2 col-sm-10 col-xs-12">
      <div class="bs-callout bs-callout-danger">
        <h4>编号：{{info.id}}</h4>
        <h4>{{info.status_cn}}</h4>
      </div>
        <!--  <div class="form-group" ng-show="basic_form.$invalid && basic_form.$dirty && show_error">
        <div class="col-sm-12">
          <div class="alert alert-danger">
            <ul>
              <li ng-show="basic_form.site_id.$error.required">请选择用户所属系统！</li>
              <li ng-show="basic_form.mobile.$error.required">请输入手机号码！</li>
              <li ng-show="basic_form.mobile.$error.pattern">手机号码格式不对！</li>
              <li ng-show="basic_form.name.$error.required">请输入用户姓名！</li>
              <li ng-show="basic_form.province.$error.required">请选择省份！</li>
              <li ng-show="basic_form.customerModel.$error.required">请选择客户类型！</li>
              <li ng-show="basic_form.kaCustomerType.$error.required">请选择KA客户账号类型！</li>
              <li  ng-show="kaCustomerType.value==1 && basic_form.kaBillCycle.$error.required">请选择结账周期！</li>
              <li  ng-show="kaCustomerType.value==1 && basic_form.kaCheckDate.$error.required">请选择对账日期！</li>
              <li  ng-show="kaCustomerType.value==1 && basic_form.kaInvoiceDate.$error.required">请选择开票日期！</li>
              <li  ng-show="kaCustomerType.value==1 && basic_form.kaPayDate.$error.required">请选择付款日期！</li>
              <li ng-show="kaCustomerType.value==2 && basic_form.kaParentMobile.$error.required">请输入关联母账号！</li>
            </ul>
          </div>
        </div>
      </div>
      -->
      <form class="form-horizontal showcase-form" role="form" id="basic_form" name="basic_form">
        <div class="form-group">
          <label class="col-sm-2 control-label">运营受理人：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.operator_name" class="form-control" placeholder="请输入店铺名称"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">地区：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.city_cn" class="form-control" placeholder="请输入店铺名称"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">线路：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.line_cn" class="form-control" placeholder="请输入店铺名称"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">订单号(母订单号)：</label>
          <div class="col-sm-9">
            <input type="text" readonly ng-model="info.order_number" class="form-control" placeholder="请输入店铺名称"></div>
            <div class="col-sm-1"><a href="javascript:void(0);" ng-href="order/detail/{{info.order_number}}">查看</a></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">订单号(子订单号)：</label>
          <div class="col-sm-9">
            <input type="text" readonly ng-model="info.suborder_number" class="form-control" placeholder="请输入店铺名称"></div>
            <div class="col-sm-1"><a href="javascript:void(0);" ng-href="order/subDetail/{{info.suborder_number}}">查看</a></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">店铺名称：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.shop_name" class="form-control" placeholder="请输入详细地址"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">客户名称：</label>
           <div class="col-sm-10">
            <input type="text" readonly ng-model="info.name" class="form-control" placeholder="请输入详细地址"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">客户电话：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.mobile" class="form-control" placeholder="请输入备注"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">客户地址：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.address" class="form-control" placeholder="请输入备注"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">送货日期：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.deliver_date|date:'yyyy-MM-dd  HH:mm'" class="form-control" placeholder="请输入备注"></div>
        </div>
        <div class="form-group">
        <label class="col-sm-2 control-label">所属BD：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-model="info.bd_name" class="form-control"></div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">订单金额：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-model="info.total_price" class="form-control" ></div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">优惠金额：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-model="info.minus_amount" class="form-control" ></div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">运费：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-model="info.deliver_fee" class="form-control" placeholder=""></div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">押金：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-model="info.deposit|currency:''" class="form-control" placeholder=""></div>
      </div>
      <div class="form-group">
          <label class="col-sm-2 control-label">拒收金额：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.refuse_price|currency:''" class="form-control" placeholder=""></div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">应付金额：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-model="info.deal_price|currency:''" class="form-control" placeholder=""></div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">支付方式：</label>
        <div class="col-sm-10">
          <input type="text" readonly ng-disabled="true" ng-model="info.pay_method_cn" class="form-control"></div>
      </div>
      <div class="form-group">
          <label class="col-sm-2 control-label">退货原因：</label>
          <div class="col-sm-10">
            <select ng-disabled="true" class="form-control" ng-model="info.reasonModel" ng-options="m.name for m in reasons">
              <option value="">请选择退货原因</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">退货详情：</label>
          <div class="col-sm-10">
            <div class="table-responsive" style="margin-top:10px;">
             <table class="table table-bordered table-striped table-hover">
                <tr>
                  <td>一级分类</td>
                  <td>SKU名</td>
                  <td>SKU编号</td>
                  <td>SKU单价</td>
                  <td>SKU数量</td>
                  <td>退款金额</td>
                </tr>
                <tr ng-repeat="item in info.content[0]">
                  <td>{{item.category_name}}</td>
                  <td>{{item.name}}</td>
                  <td>{{item.sku_number}}</td>
                  <td>{{item.price}}</td>
                  <td>{{item.quantity}}</td>
                  <td>{{item.sum_price}}</td>
                </tr>
                <tr>
                  <td colspan="4"></td>
                  <td>总计</td>
                  <td>{{info.rejected_sum_price}}</td>
                </tr>
              </table>
          </div>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">退款方式：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-disabled="true" value="{{info.pay_method==1?'微信退款':'银行退款'}}" class="form-control"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">开户行：</label>
          <div class="col-sm-10">
            <input type="text"  ng-model="info.deposit_bank" class="form-control" placeholder="请输入开户行"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">银行卡号：</label>
          <div class="col-sm-10">
            <input type="text"  ng-model="info.bank_number" class="form-control" placeholder="请输入银行卡号"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">开户人姓名：</label>
          <div class="col-sm-10">
            <input type="text"  ng-model="info.account_holder" class="form-control" placeholder="请输入开户人姓名"></div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">退货处理方式：</label>
          <div class="col-sm-10">
           <select ng-disabled="true" name="line" class="form-control" ng-model="info.dealMethod"
            ng-options="m.name for m in deal_methods" required>
              <option value="">请选择退货处理方式</option>
            </select>
           </div>
        </div>
         <div class="form-group">
          <label class="col-sm-2 control-label">客服处理意见：</label>
          <div class="col-sm-10">
            <input type="text" ng-model="info.suggestion" ng-disabled="roleID!=10"  class="form-control"  placeholder=""></div>
        </div>  
        <div class="form-group">
          <label class="col-sm-2 control-label">退货入库单号：</label>
          <div class="col-sm-10">
            <input type="text" readonly ng-model="info.withdraw_storage_number" class="form-control" placeholder=""></div>
        </div>
        <div class="form-group" ng-show="info.refund_evidence && info.status==4">
             <label class="col-sm-2 control-label">退款凭据：</label>
              <div class="col-sm-2 col-md-2" >
                <image-box url='{{info.refund_evidence}}'>
                  <image-modal show="0"  url='{{info.refund_evidence}}'></image-modal>
                </image-box>
              </div>      
        </div>
        <div class="form-group" ng-show="info.refund_evidence && (info.status==2 || info.status==3)">
           <label class="col-sm-2 control-label">退款凭据：</label>
            <div class="col-sm-2 col-md-2" >
                <div class="thumbnail">
                   <img width="100" ng-src="{{info.refund_evidence}}" class="thumbnail" />
                   <div class="caption text-center">
                    <p><a href="#" class="btn btn-primary" role="button" ng-click="evidenceCancel()">删除</a></p>
                   </div>
                 </div>
            </div>      
        </div>
        <div class="form-group" ng-show="(info.status==2 || info.status==3) && !info.refund_evidence">
             <label class="col-sm-2 control-label">退款凭据：</label>
             <span class="btn btn-success fileinput-button">
               <i class="glyphicon glyphicon-plus"></i>
                <span class="button"  ng-file-select ng-model="files">
                  上传凭据
                </span>
             </span>           
        </div>
        <div class="form-group" ng-show="(info.status==2 || info.status==3) && !info.refund_evidence">
           <label class="col-sm-2 control-label"></label>
           <div class="col-sm-2 col-md-2" ng-repeat="files in imgUploads">
             <div class="thumbnail">
               <img width="100" ng-show="files.dataUrl != null" ng-src="{{files.dataUrl}}" class="thumbnai    l" />
               <div class="caption text-center">
                <p><a href="#" class="btn btn-primary" role="button" ng-click="fileCancel($index)">删除</a></p>
               </div>
             </div>
           </div>
        </div>
        <div class="col-xs-10" ng-class="{'col-xs-10 btn-group':info.status!=0}" style="margin-left:180px;">
            <button class="btn col-xs-3 btn-lg btn-warning pull-left" ng-show="info.status!=0" ng-click="update();">保存</button>
            <button class="btn col-xs-3 btn-lg btn-primary pull-left" ng-show="info.status==1" ng-click="excuteChange('logistics')">物流已处理</button>
            <button class="btn col-xs-3 btn-primary btn-lg" ng-show="info.status==2" ng-click="excuteChange('finance')">财务已处理</button>
            <button class="btn col-xs-3 btn-primary btn-lg" ng-show="info.status==3" ng-click="excuteChange('customer')">客服已处理</button>
            <button class="btn col-xs-3 btn-lg btn-danger pull-left"  ng-show="info.status!=4 && info.status!=0" ng-click="close()">关闭</button>
            <button class="btn col-xs-3 btn-lg btn-success pull-left" ng-click="back()">返回</button>
        </div>
      </form>
    </div>
    <div class="col-sm-offset-2 col-sm-10 col-xs-12">
        <button class="btn btn-success btn-lg" ng-click="setRemark();">添加备注</button>
        <div class="table-responsive" style="margin-top:10px;">
          <table class="table table-bordered table-striped table-hover">
           <tr>
              <td>处理时间</td>
              <td>处理状态</td>
              <td>操作人</td>
           </tr>
           <tr ng-repeat="log in logs">
             <td>{{log.created_time*1000|date:'yyyy-MM-dd  HH:mm'}}</td>
             <td>{{log.content}}</td>
             <td>{{log.role_name}}[{{log.author_name}}]</td>
           </tr>
        </table>
      </div>
    </div>
  </div>
</div>
